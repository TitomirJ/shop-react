import React, {Component} from "react";
import {connect} from 'react-redux';
import {Link} from "react-router-dom";

import {fetchPhones, loadMorePhones, addPhoneToBasket, fetchCategories} from 'actions';
import {getPhones} from 'selectors';
import Layout from 'containers/layout';

import './phones.scss'

class Phones extends Component{
    onMouseOver = (event) => {
        let currentElem = null;
        if (currentElem) return;
        let target = event.target.closest('.card-product');
        if (!target) return;
        currentElem = target;
        target.classList.add("catalog-car-hover")
        let button = target.querySelector('button')
        button.classList.remove("d-none")
    };

    onMouseOut = (event) => {
        let target = event.target.closest('.card-product');
        target.classList.remove("catalog-car-hover")
        let button = target.querySelector('button')
        button.classList.add("d-none")
    };

    componentDidMount() {
        this.props.fetchCategories()
        this.props.fetchPhones()
    }

    renderPhone = (phone, index) => {
        const { description = '' } = phone;
        const {addPhoneToBasket} = this.props;
        const shortDescription = description.substr(0, 60);
        let imgStyle = {
            backgroundImage: "url(" + phone.image + ")",
            width: '100%',
            height: '230px',
            backgroundPosition: 'center',
            backgroundSize: 'contain',
            backgroundRepeat: 'no-repeat',
        };
        return (
            <div className='card-product col-12 col-md-6' key={index} onMouseEnter={this.onMouseOver} onMouseLeave={this.onMouseOut}>
                <Link to={`/phone/${phone.id}`} name={phone.name}>
                    <div>
                        <div className='thumbnail' style={imgStyle}>
                        </div>
                        <div className='about'>
                            <div className='main-info text-center'>
                                <h5>{phone.name}</h5>
                                <h5>{phone.price} $</h5>
                            </div>
                            <p className='short-description text-center'>{shortDescription}...</p>
                        </div>
                    </div>
                </Link>
                <div className='d-flex justify-content-center'>
                    <button className='d-none btn btn-catalog' onClick={() => addPhoneToBasket(phone.id)}>
                        Add to Cart
                    </button>
                </div>
            </div>
        )
    };

    render() {
        const {phones, loadMorePhones} = this.props;
        return (
            <Layout>
                <div className='books row'>
                    {phones.map((phone, index) => this.renderPhone(phone, index))}
                </div>
                <div className='col-md-12'>
                    <button onClick={loadMorePhones} className='btn btn-catalog'>
                        Load More
                    </button>
                </div>
            </Layout>

        )
    }
}

const mapStateToProps = (state, ownProps) => ({
    phones: getPhones(state, ownProps)
});

const mapDispatchToProps = {
    fetchPhones,
    loadMorePhones,
    addPhoneToBasket,
    fetchCategories
};

export default connect(
    mapStateToProps,
    mapDispatchToProps
)(Phones)